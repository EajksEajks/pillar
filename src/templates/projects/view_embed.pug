include ../mixins/components

| {% block body %}
#node-container
	section.node-preview.project
		| {% if header_video_file %}
		video#videoplayer.video-js.vjs-fluid(
			controls,
			data-setup="{}",
			preload="auto",
			poster="{% if header_video_node.picture %}{{ header_video_node.picture.thumbnail('l', api=api) }}{% endif %}")
			| {% for source in header_video_file.variations %}
			source(
				src="{{ source.link | safe }}",
				type="{{ source.content_type }}")
			| {% endfor %}
			p.vjs-no-js.
				To view this video please enable JavaScript, and consider upgrading to a web browser that
				<a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a>
		| {% elif project.picture_header %}
		a(href="{{ url_for( 'projects.view', project_url=project.url) }}")
			img.header(src="{{ project.picture_header.thumbnail('l', api=api) }}")
		| {% endif %}

	section.node-details-container.project
		h2.px-3.pt-3
			a.text-muted(href="{{ url_for( 'projects.view', project_url=project.url) }}") {{ project.name }}

		| {% if project.description %}
		.node-details-description
			| {{ project | markdowned('description') }}
		| {% endif %}

		| {# Until we implement urls for pages
		a.learn-more(href="{{ url_for( 'projects.view', project_url=project.url) }}") LEARN MORE
		| #}

		.p-4
			| {% if activity_stream %}
			+card-deck(3)
				| {% for n in activity_stream %}
				| {% if n.node_type not in ['comment'] %}
				+list-asset(
					'{{ n.name }}',
					'{{ url_for_node(node=n) }}',
					"{% if n.picture %}{{ n.picture.thumbnail('l', api=api) }}{% endif %}",
					"{% if n.properties.content_type %}{{ n.properties.content_type | undertitle }}{% else %}{{ n.node_type | undertitle }}{% endif %}",
					"{{ n._updated | pretty_date }}")(class="{% if n.permissions.world %}free{% endif %}")
				| {% endif %}
				| {% endfor %}
			| {% endif %}

include _scripts

script(src="{{ url_for('static_pillar', filename='assets/js/vendor/jquery.montage.min.js') }}")
script.
	function montage(){
		var $container 	= $('#featured-list'),
			$imgs		= $container.find('img').hide(),
			totalImgs	= $imgs.length,
			cnt			= 0;

		$imgs.each(function(i) {
			var $img	= $(this);
			$('<img/>').on('load', function() {
				++cnt;
				if( cnt === totalImgs ) {
					$imgs.show();
					$container.montage({
						fillLastRow	: true,
							alternateHeight	: true,
							alternateHeightRange : {
								min	: 180,
								max	: 240
							},
							margin : 3
					});
				}
			}).attr('src',$img.attr('src'));
			$img.parent().removeClass('hidden');
		});
	}

	$(function() {
		montage();

		$(".node-updates-list-item.asset, .node-updates-list-item.group")
				.unbind('click')
				.click(function(e) {
			e.preventDefault();
			displayNode($(this).data('node_id'));
		});
	});

| {% endblock %}
